============================= test session starts =============================
platform win32 -- Python 3.13.7, pytest-9.0.2, pluggy-1.6.0 -- D:\Coding\Website\Prompt-Improver\venv\Scripts\python.exe
cachedir: .pytest_cache
rootdir: D:\Coding\Website\Prompt-Improver
plugins: anyio-4.12.1
collecting ... collected 14 items

tests/test_rate_limiter.py::TestConstants::test_logged_in_limit PASSED   [  7%]
tests/test_rate_limiter.py::TestConstants::test_anonymous_limit PASSED   [ 14%]
tests/test_rate_limiter.py::TestGetDailyLimit::test_anonymous PASSED     [ 21%]
tests/test_rate_limiter.py::TestGetDailyLimit::test_logged_in PASSED     [ 28%]
tests/test_rate_limiter.py::TestLoggedInRateLimiting::test_fresh_user_allowed PASSED [ 35%]
tests/test_rate_limiter.py::TestLoggedInRateLimiting::test_allows_up_to_limit PASSED [ 42%]
tests/test_rate_limiter.py::TestLoggedInRateLimiting::test_blocks_after_limit FAILED [ 50%]
tests/test_rate_limiter.py::TestLoggedInRateLimiting::test_remaining_prompts FAILED [ 57%]
tests/test_rate_limiter.py::TestAnonymousRateLimiting::test_fresh_anonymous_allowed PASSED [ 64%]
tests/test_rate_limiter.py::TestAnonymousRateLimiting::test_blocks_after_one FAILED [ 71%]
tests/test_rate_limiter.py::TestAnonymousRateLimiting::test_remaining_prompts_anonymous FAILED [ 78%]
tests/test_rate_limiter.py::TestPersistence::test_save_and_load PASSED   [ 85%]
tests/test_rate_limiter.py::TestPersistence::test_load_missing_file PASSED [ 92%]
tests/test_rate_limiter.py::TestMultipleUsers::test_independent_limits FAILED [100%]

================================== FAILURES ===================================
______________ TestLoggedInRateLimiting.test_blocks_after_limit _______________
tests\test_rate_limiter.py:68: in test_blocks_after_limit
    assert check_rate_limit(email, is_anonymous=False) is False
E   AssertionError: assert True is False
E    +  where True = check_rate_limit('user@example.com', is_anonymous=False)
_______________ TestLoggedInRateLimiting.test_remaining_prompts _______________
tests\test_rate_limiter.py:72: in test_remaining_prompts
    assert get_remaining_prompts(email, is_anonymous=False) == 5
E   AssertionError: assert 9999 == 5
E    +  where 9999 = get_remaining_prompts('user@example.com', is_anonymous=False)
_______________ TestAnonymousRateLimiting.test_blocks_after_one _______________
tests\test_rate_limiter.py:87: in test_blocks_after_one
    assert check_rate_limit(session_id, is_anonymous=True) is False
E   AssertionError: assert True is False
E    +  where True = check_rate_limit('anon_abc123', is_anonymous=True)
_________ TestAnonymousRateLimiting.test_remaining_prompts_anonymous __________
tests\test_rate_limiter.py:91: in test_remaining_prompts_anonymous
    assert get_remaining_prompts(session_id, is_anonymous=True) == 1
E   AssertionError: assert 9999 == 1
E    +  where 9999 = get_remaining_prompts('anon_xyz789', is_anonymous=True)
__________________ TestMultipleUsers.test_independent_limits __________________
tests\test_rate_limiter.py:122: in test_independent_limits
    assert check_rate_limit(user_a, is_anonymous=False) is False
E   AssertionError: assert True is False
E    +  where True = check_rate_limit('alice@example.com', is_anonymous=False)
=========================== short test summary info ===========================
FAILED tests/test_rate_limiter.py::TestLoggedInRateLimiting::test_blocks_after_limit
FAILED tests/test_rate_limiter.py::TestLoggedInRateLimiting::test_remaining_prompts
FAILED tests/test_rate_limiter.py::TestAnonymousRateLimiting::test_blocks_after_one
FAILED tests/test_rate_limiter.py::TestAnonymousRateLimiting::test_remaining_prompts_anonymous
FAILED tests/test_rate_limiter.py::TestMultipleUsers::test_independent_limits
========================= 5 failed, 9 passed in 0.56s =========================
